name: Auto Generate Index

on:
  push:
    branches:
      - main
    paths-ignore:
      - 'index.html'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      
      - name: Generate index.html
        run: |
          echo "<!DOCTYPE html><html lang='ja'><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title>Contents Index</title><style>body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;padding:40px;line-height:1.6;max-width:800px;margin:auto;background:#f9f9f9;}h1{border-bottom:2px solid #eee;padding-bottom:10px;}ul{list-style:none;padding:0;}li{background:#fff;margin:10px 0;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.05);transition:transform 0.2s;}li:hover{transform:translateX(5px);}a{color:#0366d6;text-decoration:none;font-weight:bold;display:block;}small{color:#888;}</style></head><body>" > index.html
          echo "<h1>Contents Index</h1><p>ÂÖ¨Èñã‰∏≠„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà‰∏ÄË¶ß</p><ul>" >> index.html
          
          for dir in $(find . -maxdepth 2 -name "index.html" | cut -d'/' -f2 | sort | uniq); do
            if [ "$dir" != "." ] && [[ "$dir" != .* ]]; then
              echo "<li><a href='./$dir/'>üìÅ $dir</a></li>" >> index.html
            fi
          done
          
          echo "</ul><footer style='margin-top:50px;'><small>Last updated: $(date +'%Y-%m-%d %H:%M')</small></footer></body></html>" >> index.html

      - name: Commit and Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add index.html
          git commit -m "chore: auto-update index.html" || exit 0
          git push
